<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Group Management</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="DolphinDB Group Management">
    <meta name="author" content="DolphinDB">
    <link rel="stylesheet" href="../third-party/bootstrap/css/bootstrap.min.css">
    <link href="../third-party/jsgrid/jsgrid.css" rel="stylesheet" />
    <link href="../css/custom-theme/jquery-ui.css" rel="stylesheet" />
    <link href="../third-party/jsgrid/jsgrid-theme.css" rel="stylesheet" />
    <link rel="stylesheet" href="../css/dialog.css">
</head>

<body>
    <div class="dd_mainbody" style="height:95vh">
        <div>
            <div class="panel">
                <div class="btn-toolbar" role="toolbar" aria-label="...">
                    <div class="btn-group" role="group" aria-label="...">
                        <button type="button" class="btn btn-default" id="btn_Add">Add</button>
                        <button type="button" class="btn btn-default" id="btn_Del">Delete</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="panel" style="height:90vh">
            <div id="jsgrid"> </div>
        </div>
    </div>

    <div id="dialogAdd" title="Add Group" class="modal">
        <p></p>
        <div class="input-group">
            <span class="input-group-addon" id="basic-addon1">Name</span>
            <input id="txtGroupname" type="text" class="form-control" placeholder="Group Name" aria-describedby="basic-addon1">
        </div>
    </div>

    <div id="dialogGrant" class="modal fade" role="dialog">

    </div>

    <script src="../third-party/bootstrap/js/vendor/jquery-1.9.1.min.js" type="text/javascript"></script>
    <script src="../third-party/bootstrap/js/vendor/jquery-migrate-1.2.1.min.js" type="text/javascript"></script>
    <script src="../third-party/bootstrap/js/vendor/bootstrap.js" type="text/javascript"></script>
    <script src="../third-party/jsgrid/jsgrid.js" type="text/javascript"></script>
    <script src="../js/utils.js" type="text/javascript"></script>
    <script src="../js/executecode.js" type="text/javascript"></script>
    <script src="../js/CallWebApi.js" type="text/javascript"></script>
    <script src="../third-party/bootstrap/js/vendor/jquery-ui-1.10.3.custom.min.js" type="text/javascript"></script>
    <script src="../js/dolphinApi.js" type="text/javascript"></script>
    <script src="../js/datagrid.js" type="text/javascript"></script>
    <script src="../js/dialog.js" type="text/javascript"></script>
    <script type="text/javascript">
        var controllerUrl = GetFullUrl(window.location.host);
        var ctlApi = null;
        $(function () {
            ctlApi = new ControllerServer(controllerUrl);
            ctlApi.getGroupList(function (re) {
                //var ent = new DolphinEntity(re).toVector();
                var ent = DolphinResult2Grid(re);
                $('#jsgrid').jsGrid({
                    width: "100%",
                    height: "400px",
                    data: ent,
                    resize: true,
                    fields: [
                        {
                            headerTemplate: function () {
                                return $("<input>").attr("type", "checkbox")
                                    .on("click", function () {
                                        selectAllItems($(this).attr("checked"));
                                    });
                            },
                            itemTemplate: function (_, item) {
                                return $("<input>").attr("type", "checkbox").attr("name", "chkSelect")
                                    .on("change", function () {
                                        $(this).is(":checked") ? selectItem(item) : unselectItem(item);
                                    });
                            },
                            align: "center",
                            width: 50
                        },
                        { name: "name", title: "Group Name", type: "text", width: 150 },
                        {
                            name: "action", type: "text", width: 50,
                            itemTemplate: function (item, value) {
                                return "<a href='###'>Grant</a>"
                            }
                        }
                    ]
                });
            });
        });

        var selectItem = function (item) {

        };

        var selectAllItems = function (isSel) {
            $("[name='chkSelect']").each(function (i, e) {
                if (isSel)
                    $(e).attr("checked");
                else
                    $(e).removeAttr("checked");
            });

        };

        var unselectItem = function (item) {
            selectedItems = $.grep(selectedItems, function (i) {
                return i !== item;
            });
        };

        $("#btn_Add").bind("click", function () {
            var dialog = new DolphinDialog("dialogAdd");
            dialog.open(
                {
                    width: 300,
                    height: 200,
                    modal: true,
                    buttons: {
                        "Save": function () {
                            ctlApi.createGroup($("#txtGroupname").val(),function(){
                                $('#jsgrid').jsGrid("refresh");
                            });
                        },
                        "Cancel": function () {
                            $(this).dialog("close");
                        }
                    }
                }
            );
        });

        $("#btn_Del").bind("click", function () {

        });
    </script>
</body>

</html>